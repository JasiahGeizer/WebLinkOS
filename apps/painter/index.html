<html>
<title>Painter</title>
<!--
	To Do:
		- Add Shapes
		- Add Text
		- increase canvas size??
-->
  <style type="text/css">
    *{
      font-family: monospace;
      background-color: lightsteelblue;
    }
    canvas{
            margin: 0 auto;
              padding: 3px; 
              list-style-type: none;
              resize:none;
              display:block;
              margin-top:20px; 
              margin-bottom: 10px;
              height: 400px;
              width: 400px;
              background: ghostwhite;
              border:2px solid lightgrey;
          }
    .grouped{
        position: relative;
        background-color: #594a69;
        width: 540px;
        height: 580px;
        top: 50px;
        margin: 0 auto;
        border-radius: 20px;
        box-shadow: 0px 2px 13px grey;  
        color: white;   
      }
    .colors{
      display: inline-block;
    }
    button:focus {
        outline: 0;
        box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, .25);
    }
    button{
    	border:0px;padding:5px;box-shadow:0px 1px 4px black;position:relative;left:240px;top:-119;background-color: gainsboro;
    }
  </style>
  <script type="text/javascript">
  var canvas, canvasimg, backgroundImage, finalImg;
  var	mouseClicked = false;
  var prevX = 0;
  var currX = 0;
  var prevY = 0;
  var currY = 0;
  var fillStyle = "black";
  var globalCompositeOperation = "source-over";
  var lineWidth = 2;

  function init() {
    var imageSrc = ''
    backgroundImage = new Image();
    backgroundImage.src = imageSrc;
    canvas = document.getElementById('can');
    finalImg = document.getElementById('finalImg');
    canvasimg = document.getElementById('canvasimg');
    canvas.style.backgroundImage = "url('" + imageSrc + "')";
    canvas.addEventListener("mousemove", handleMouseEvent);
    canvas.addEventListener("mousedown", handleMouseEvent);
    canvas.addEventListener("mouseup", handleMouseEvent);
    canvas.addEventListener("mouseout", handleMouseEvent);
  }
var oldbtn2;
var oldON2=false;
  function getColor(btn) { 
    globalCompositeOperation = 'source-over';
    //lineWidth = 2;
    switch (btn.getAttribute('data-color')) {
      case "black":
      fillStyle = "black";
      pickColor(btn);
      document.getElementById(btn.id).style.boxShadow="inset 2px 2px 0px grey";
      break;
      case "pink":
      fillStyle = btn.style.backgroundColor;
      pickColor(btn);
      break;
      case "eraser":
      globalCompositeOperation = 'destination-out';
      fillStyle = "rgba(0,0,0,1)";
      pickColor(btn);
      //lineWidth = 14;
      break;
    }
  }

  function getType(btn) { 
    globalCompositeOperation = 'source-over';
    //lineWidth = 2;
    switch (btn.getAttribute('data-color')) {
      case "Fill":
      fillorNot=1;
      document.getElementById("15").style.boxShadow="0px 0px 0px black";
      document.getElementById("14").style.boxShadow="inset 2px 2px 0px black";
      break;
      case "Draw":
      fillorNot=0;
      document.getElementById("14").style.boxShadow="0px 0px 0px black";
      document.getElementById("15").style.boxShadow="inset 2px 2px 0px black";
      break;
    }
  }



  var fillorNot=0;
  function pickColor(color){
    if(oldON2==true){
        document.getElementById(oldbtn2.id).style.boxShadow="0px 0px 0px black";
      }else{
        oldON2=true;
      }
      document.getElementById(color.id).style.boxShadow="inset 2px 2px 0px black";
      oldbtn2=color;
  }

  function draw(dot) {
    var ctx = canvas.getContext("2d");
    ctx.beginPath();
    ctx.globalCompositeOperation = globalCompositeOperation;
    if (fillorNot==1) {
      ctx.fillStyle = fillStyle;
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      //ctx.beginPath(); 
      //ctx.fillStyle=fillStyle;
      //ctx.fillRect(rect.startX, rect.startY, rect.w, rect.h);
      //ctx.stroke();
    }else if(dot){
      ctx.fillStyle = fillStyle;
      ctx.fillRect(currX, currY, 2, 2);
    } else {
      ctx.beginPath();
      ctx.moveTo(prevX, prevY);
      ctx.lineTo(currX, currY);
      ctx.strokeStyle = fillStyle;
      ctx.lineWidth = lineWidth;

      ctx.stroke();
    }
    ctx.closePath();
  }

  function erase() {
    if (confirm("Want to clear")) {
    	var ctx = canvas.getContext("2d");
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      document.getElementById("canvasimg").style.display = "none";
    }
  }

  function save() {
	 var link = document.getElementById('link');
	  link.setAttribute('download', 'painter.png');
	  link.setAttribute('href', canvas.toDataURL("image/png").replace("image/png", "image/octet-stream"));
  }
  rect = {},
drag = false;
var rectStartXArray = new Array() ;
var rectStartYArray = new Array() ;
var rectWArray = new Array() ;
var rectHArray = new Array() ;
  function handleMouseEvent(e) {
    if (e.type === 'mousedown') {
        //rect.startX = e.pageX - this.offsetLeft;
        //rect.startY = e.pageY - this.offsetTop;
      prevX = currX;
      prevY = currY;
      currX = e.offsetX;
      currY = e.offsetY;
      mouseClicked = true;
      draw(true);
    }
    if (e.type === 'mouseup' || e.type === "mouseout") {
      mouseClicked = false;
    //rectStartXArray[rectStartXArray.length] = rect.startX;
    //rectStartYArray[rectStartYArray.length] = rect.startY;
    //rectWArray[rectWArray.length] = rect.w;
    //rectHArray[rectHArray.length] = rect.h;
    }
    if (e.type === 'mousemove') {
      if (mouseClicked) {
        prevX = currX;
        prevY = currY;
        currX = e.offsetX;
        currY = e.offsetY;
        //rect.w = (e.pageX ) - rect.startX-140;
        //rect.h = (e.pageY ) - rect.startY-110;
        draw();
      }
    }
  }
  var oldbtn;
  var oldON=false;
  function setSize(size,btn){
    lineWidth=size;
    btn.style.boxShadow="inset 2px 2px 0px black";
    if (oldON==true) {
      oldbtn.style.boxShadow="0px 1px 4px black";
    }else{
      oldON=true;
    }
    
    oldbtn=btn;
    
  }
  </script>

  <body onload="init()">Painter
    <div class="grouped"><br>
      <canvas id="can" width="400" height="400"></canvas>

    <div style="left: 65px;top:5px;height:80px;position: relative;background-color: #675877;padding:5px;width: 35%;">Choose Color<p style="margin: 5px;position: relative;">
        <div id="1" class="colors" style="position:relative;width:25px;height:25px;background:black;" data-color="black" onclick="getColor(this)"></div>
        <div id="2" class="colors" style="position:relative;width:25px;height:25px;background:red;" data-color="pink" onclick="getColor(this)"></div>
        <div id="3" class="colors" style="position:relative;width:25px;height:25px;background:yellow;" data-color="pink" onclick="getColor(this)"></div>
        <div id="4" class="colors" style="position:relative;width:25px;height:25px;background:green;" data-color="pink" onclick="getColor(this)"></div>
        <div id="5" class="colors" style="position:relative;width:25px;height:25px;background:blue;" data-color="pink" onclick="getColor(this)"></div>
        <div id="6" class="colors" style="position:relative;width:25px;height:25px;background:purple;" data-color="pink" onclick="getColor(this)"></div>

        <div id="7" class="colors" style="position:relative;width:25px;height:25px;background:grey;" data-color="pink" onclick="getColor(this)"></div>
        <div id="8" class="colors" style="position:relative;width:25px;height:25px;background:orange;" data-color="pink" onclick="getColor(this)"></div>
        <div id="9" class="colors" style="position:relative;width:25px;height:25px;background:lightyellow;" data-color="pink" onclick="getColor(this)"></div>
        <div id="10" class="colors" style="position:relative;width:25px;height:25px;background:lightgreen;" data-color="pink" onclick="getColor(this)"></div>
        <div id="11" class="colors" style="position:relative;width:25px;height:25px;background:lightblue;" data-color="pink" onclick="getColor(this)"></div>
        <div id="12" class="colors" style="position:relative;width:25px;height:25px;background:pink;" data-color="pink" onclick="getColor(this)"></div>      

        <div style="position:relative;left:236px;top:-80px;background-color:#594a69;padding-top:5px;text-align: center;width:50px;height:25px;">Eraser</div>
        <div id="13" style="position:relative;left:240px;top:-86px;width:43px;height:21px;background:white;border:2px solid;" data-color="eraser" onclick="getColor(this)"></div>

        <div style="position:relative;left:238px;top:-80px;background-color:#594a69;padding-top:5px;text-align: center;width:50px;height:25px;">Fill</div>
        <div id="14" style="position:relative;left:250px;top:-86px;width:25px;height:21px;background:lightgrey;border:2px solid darkgrey;" data-color="Fill" onclick="getType(this)"></div>
         <div style="position:relative;left:198px;top:-135px;background-color:#594a69;padding-top:5px;text-align: center;width:50px;height:25px;">Draw</div>
        <div id="15" style="position:relative;left:210px;top:-141px;width:25px;height:21px;background:lightgrey;border:2px solid darkgrey;" data-color="Draw" onclick="getType(this)"></div>
    </div>

     <canvas id="canvasimg" style="display:none;" ></canvas>
     <!--  <img id="finalImg" style="position:absolute;top:10%;left:52%;display:none;" >-->

      <input type="button" value="clear" id="clr" size="23" onclick="erase()" style="box-shadow: 0px 0px 3px black;background-color: lightgrey;padding:7px;border:0px; position:relative;left:371px;top:-10px;">
      <a type="button" value="save" id="link" size="23" onclick="save()" style="box-shadow: 0px 0px 3px black;background-color: lightgrey;padding:7px;border:0px; position:relative;left:371px;top:-10px;color:black">Save</a>

      <div style="position:relative;left:365px;top:-113px;background-color:#594a69;padding-top:5px;text-align: center;width:75px;height:25px;">Brush Size</div>
	      <button onclick="setSize(20,this)" style="left: 365px; position: relative;">20</button>
	      <button onclick="setSize(10,this)" style="left: 365px; position: relative;">10</button>
	      <button onclick="setSize(5,this)" style="left: 365px; position: relative;">5</button>
	      <button onclick="setSize(2,this)" style="left: 365px; position: relative;">2</button>
    </div>
  </body>
</html>