<!DOCTYPE html>
<html lang="en">
  <!--
      To Do:
        - Add sound effects (explosion, shooting, thurster)
        - Add thruster animation & Ship explosion animation

        - Add show when won & levels number
        - At start, Add boulders, display "level 1" text, increment amount of boulders with each level.
        - put all boulders and bullets into empty divs to group them


        0.1: Added Ship and Asteroid art, added ship movement, added ship loop around
        0.2: Added collision detection (on boulders/ship), added function for boulder creation, give new boulders random position on screen, added boulder shrinking & destroyable,shoot creates bullets, added bullet movement at ship velocity/direction,added collision detection between bullets and boulders,
        0.3: fixed bullet speed and direction, created better method of bullet/boulder removal (querySelectorAll), remove bullets when they hit the edge, boulders move and loop around, boulders change direction on hit, new level function, round win detection, added instructions,
    -->
	<head>
		<meta charset="utf-8">
	  	<title>Asteroids</title>

	  	<style type="text/css">
  		body{
        overflow: hidden;
  			background: #232323;
  		}
      #player{
        position: absolute;
        width: 0;
        height: 0;
        border-style: solid;
        border-width: 0 15px 30px 15px;
        border-color: transparent transparent #eaeaea transparent;
        z-index: 2;
      }
      .hexagon {
          overflow: hidden;
          visibility: hidden;
          transform: rotate(120deg);
          position: absolute;
          }
      .hexagon-in1 {
          overflow: hidden;
          height: 100%;
          transform: rotate(-60deg);
          }
      .hexagon-in2 {
          background: grey;
          height: 100%;
          visibility: visible;
          transform: rotate(-60deg);
          }
	  	</style>
	</head>
	<body onkeydown="moveSelection(event)" onkeyup="moveSelection2(event)">
      <div id="player" data-rad="15" style="left: 200px;top: 200px;"></div>	

      <div id="b1" data-x="2" data-y="1" data-rad="50" style="left:100px;top:500px;width:100px;height: 100px;" class="hexagon"><div class="hexagon-in1"><div class="hexagon-in2" style="color: lightgrey;text-align:center;line-height:10px;font-family:monospace;font-size: 12px;"><br>Spacebar<br> to shoot.<br><br>Arrow keys<br> to move.<br><br>Shoot me to begin</div></div></div>
      <!--<div id="b2" data-x="0" data-y="0" data-rad="25" style="left:100px;top:100px;width: 50px;height: 50px;" class="hexagon dodecagon"><div class="hexagon-in1"><div class="hexagon-in2"></div></div></div>
      <div id="b3" data-x="0" data-y="0" data-rad="15" style="left:100px;top:300px;width: 30px;height: 30px;" class="hexagon dodecagon"><div class="hexagon-in1"><div class="hexagon-in2"></div></div></div>-->


		<script type="text/javascript">

/* _______________________________________ Boulders & Collision _______________________________________ */
      //var pRad=rad3=15;var rad2=25; rad1=50; 

      var player=document.getElementById("player");
      var distX,distY,radSum,bRad,bL,bT;
      var distX2,distY2,radSum2,bRad2,bL2,bT2;
      var bCount=1;
      var i;
      
      
      function radiiCheck(){ /*Ship & Boulder Collision*/
        var QSA2 = document.querySelectorAll(".hexagon");
        if (QSA2.length==0) {newLevel();}
        for (i = 0; i < QSA2.length; i++) {
          bRad=parseInt(QSA2[i].getAttribute("data-rad"));
          bT=(parseInt(QSA2[i].style.top)+bRad);
          bL=(parseInt(QSA2[i].style.left)+bRad);

          distX = (parseInt(player.style.top)+15)-bT;
          distY = (parseInt(player.style.left)+15)-bL;
          radSum=15+bRad; 

          if (distX * distX + distY * distY <= radSum * radSum) {
            console.log(distX * distX + distY * distY,radSum * radSum,"ship hit");
            shrinkBoulder(QSA2[i]); //swaps collision end to boulder shrink 
            end("down");
          }
        }
      }
      function radiiCheck2(){ /*Bullet & Boulder Collision*/
        QSA2 = document.querySelectorAll(".hexagon");
        for (i9 = 0; i9 < QSA2.length; i9++) {
          bRad2=parseInt(QSA2[i9].getAttribute("data-rad"));
          bT2=(parseInt(QSA2[i9].style.top)+bRad2);
          bL2=(parseInt(QSA2[i9].style.left)+bRad2);

          QSA1 = document.querySelectorAll(".bullet");
          for (var i8 = 0; i8 < QSA1.length; i8++) {
           thisBullet2 = QSA1[i8];
            distX2 = (parseInt(thisBullet2.style.top)+5)-bT2;
            distY2 = (parseInt(thisBullet2.style.left)+5)-bL2;
            radSum2=5+bRad2; 
          
            if (distX2 * distX2 + distY2 * distY2 <= radSum2 * radSum2) {
                console.log(distX2 * distX2 + distY2 * distY2,radSum2 * radSum2,"BULLET HIT");
                shrinkBoulder(QSA2[i9]);
                QSA1[i8].remove();
            }
          }
        }
      }
      function boulderINT(){
        var bINT = Math.round((Math.random() * 8)-4);
        if (bINT==0) {bINT=boulderINT();}
        return bINT;
      }
      function createBoulder(){
        //create boulder
        //give boulder location and velocity 
        //increment boulderCount
        var newX=Math.floor(Math.random() * W);
        var newY=Math.floor(Math.random() * H);

        var newB = document.createElement("DIV");
        newB.style.left=newY+"px"; 
        newB.style.top=newX+"px"; 
        newB.style.width="100px";
        newB.style.height="100px";
        newB.id="b"+(bCount+1);
        newB.setAttribute('class', 'hexagon');
        newB.setAttribute('data-rad', '50');
        newB.setAttribute('data-x', boulderINT());
        newB.setAttribute('data-y', boulderINT());
        document.body.appendChild(newB);

        var newB2 = document.createElement("DIV");
        newB2.setAttribute('class', 'hexagon-in1');
        document.getElementById("b"+(bCount+1)).appendChild(newB2);

        var newB3 = document.createElement("DIV");
        newB3.setAttribute('class', 'hexagon-in2');
        document.getElementById("b"+(bCount+1)).childNodes[0].appendChild(newB3);
        bCount++;
      }

      function shrinkBoulder(that){
        //console.log(that);
        if (that.id=="b1") {
          that.remove();
        }else if (that.getAttribute("data-rad")==50) { //if biggest get hits then make medium and duplicate
          that.setAttribute('data-rad', '25');
          that.style.width="50px";
          that.style.height="50px";
          that.setAttribute("data-y", boulderINT());
          that.setAttribute("data-x", boulderINT());
        
          var cln = that.cloneNode(true);
          cln.id="b"+(bCount+1);
          cln.style.left=parseInt(cln.style.left)+55+"px";
          cln.style.top=parseInt(cln.style.top)+55+"px";
          cln.setAttribute("data-y", boulderINT());
          cln.setAttribute("data-x", boulderINT());
          document.body.appendChild(cln);
          bCount++;
          }else if (that.getAttribute("data-rad")==25) { //if medium get hits then make small and duplicate
            that.setAttribute('data-rad', '15');
            that.style.width="25px";
            that.style.height="25px";
            that.setAttribute("data-y", boulderINT());
            that.setAttribute("data-x", boulderINT());

            var cln2 = that.cloneNode(true);
            cln2.id="b"+(bCount+1);
            cln2.style.left=parseInt(cln2.style.left)+20+"px";
            cln2.style.top=parseInt(cln2.style.top)+20+"px";
            cln2.setAttribute("data-y", boulderINT());
            cln2.setAttribute("data-x", boulderINT());
            document.body.appendChild(cln2);
            bCount++;
            }else if (that.getAttribute("data-rad")==15){ //if smallest get hits then remove
              //that.childNodes[1].childNodes[0]
              that.remove(); //boulder destroyed
            }
      }
/* _______________________________________ Boulder Movement and Loop Around _______________________________________ */
      /*boulder movement
      function test(){
        var xx = document.querySelectorAll(".hexagon");
        var xxx;
        for (xxx = 0; xxx < xx.length; xxx++) {
          xx[xxx].style.backgroundColor = "red";
        }
      }*/

      function moveBoulders(){
        QSA2 = document.querySelectorAll(".hexagon");
        for (var xy = 0; xy < QSA2.length; xy++) {
          //console.log(QSA2[xy].getAttribute("data-X"),QSA2[xy].getAttribute("data-Y"));
          QSA2[xy].style.left =   parseInt(QSA2[xy].style.left) + parseInt(QSA2[xy].getAttribute("data-x"))+"px";
          QSA2[xy].style.top  =   parseInt(QSA2[xy].style.top)  + parseInt(QSA2[xy].getAttribute("data-y"))+"px";
        }
      }

      function outOfBordersBoulder(){
        QSA2 = document.querySelectorAll(".hexagon");
        H = window.innerWidth;
        W = window.innerHeight;
        for (var i3 = 0; i3 < QSA2.length; i3++) {
          var aBldr = QSA2[i3];
          
          if(parseInt(aBldr.style.top) > W){aBldr.style.top = parseInt(aBldr.style.top) - parseInt(W)+"px";}
          if(parseInt(aBldr.style.top) < 0){aBldr.style.top = parseInt(W)+"px";}
          if(parseInt(aBldr.style.left) > H){aBldr.style.left = parseInt(aBldr.style.left) - parseInt(H)+"px";}
          if(parseInt(aBldr.style.left) < 0){aBldr.style.left = parseInt(H)+"px";}
        }
      }
/* _______________________________________ Ammo & Bullets _______________________________________ */

          var thisBullet;
          var thisRotation;
      function shooting(){
        var ammo = document.createElement("DIV");
        ammo.style.height="10px";
        ammo.style.width="10px";
        ammo.style.background="red";
        ammo.style.borderRadius="10px";
        ammo.style.position="absolute";
        ammo.setAttribute('data-rot', rotation);
        ammo.style.left=parseInt(player.style.left)+8+"px";
        ammo.style.top=parseInt(player.style.top)+8+"px";
        ammo.className="bullet";
        document.body.appendChild(ammo);
      }
      function moveBullets(){ //fix to shoot infront of ship, not behind.
        var QSA1 = document.querySelectorAll(".bullet");
        for (var i2 = 0; i2 < QSA1.length; i2++) {
           thisBullet = QSA1[i2];
           thisRotation = thisBullet.getAttribute("data-rot");

          thisBullet.style.top = parseInt(thisBullet.style.top)- (Math.cos(thisRotation*(Math.PI/180))) * 10 +"px";
          thisBullet.style.left = parseInt(thisBullet.style.left) + (Math.sin(thisRotation*(Math.PI/180))) * 10 +"px";
        }
      }

      function outOfBordersBullets(){
        QSA1 = document.querySelectorAll(".bullet");
        H = window.innerWidth;
        W = window.innerHeight;
        for (var i3 = 0; i3 < QSA1.length; i3++) {
           var thatBullet = QSA1[i3];
          
          if (parseInt(thatBullet.style.top) > W || parseInt(thatBullet.style.top) < 0 
          || parseInt(thatBullet.style.left) > H || parseInt(thatBullet.style.left) < 0) {
                  thatBullet.remove();
          }
        }
      }
/* _______________________________________ Movement & Controls _______________________________________ */
      var d=u=l=r=s=false;
      var d1=u1=l1=r1=s1=false;
      function moveSelection(evt) { //wasd to move  
      switch (evt.keyCode) {
          case 37:
          case 65: //left
            if (l1==false) {
              l = setInterval(move, 20, "l");
              l1=true;
            }
            break;
          case 39:
          case 68: //Right
            if (r1==false) {
              r = setInterval(move, 20, "r");
              r1=true;
            }
            break;
          case 38:
          case 87: //up
            if (u1==false) {
              u = setInterval(move, 20, "u");
              u1=true;
            }
            break;
          case 40: //down
          case 83: //down
            if (d1==false) {
              d = setInterval(move, 20, "d");
              d1=true;
            }
            break;
          case 32: //space
            if (s1==false) {
              s = setInterval(move, 150, "s"); //bullet speed
              s1=true;
            }
            break;
          default:
            break; 
          }
      }
      function moveSelection2(evt) { //wasd to move  
      switch (evt.keyCode) {
          case 37:
          case 65: //left
              clearInterval(l);
              l1=false;
            break;
          case 39:
          case 68: //Right
              clearInterval(r);
              r1=false;
            break;
          case 38:
          case 87: //up
              clearInterval(u);
              u1=false;
            break;
          case 40: 
          case 83: //down
              clearInterval(d);
              d1=false;
            break;
          case 32: //space
              clearInterval(s);
              s1=false;
            break;
          default:
            break; 
          }
      }
      var rotation=0;
      var speed=0;
      function move(direction){
        switch (direction){
          case "l":
            rotation=rotation-5;
            rotate();
            break;
          case "r":
            rotation=rotation+5;
            rotate();
            break;
          case "d":
            vx=vx/2;
            vy=vy/2;
            break;
          case "u":
            speed=speed+1;
            forward();
            break;
          case "s":
            shooting();
            break;
        }
      }
      var p=document.getElementById("player");
      function rotate(){
        if (rotation>360) {rotation=0}
        if (rotation<0) {rotation=360}
        p.style.transform='rotate('+rotation+'deg)';
      //console.log(rotation);
      }
      var maxVel = 10;
      var frict = 0.99;
      var vx=vy=0;
      var dv = 0.2;
      var dt = 1;
      function forward(){
            vx += dv * Math.cos(rotation*(Math.PI/180));
            vy += dv * Math.sin(rotation*(Math.PI/180));
            if(vx > maxVel){vx = maxVel;}
            if(vy > maxVel){vy = maxVel;}
          }
      var intr=setInterval(alwaysOn,20);
      function alwaysOn(){
          radiiCheck();radiiCheck2();
          moveBullets();moveBoulders();
            p.style.top = parseInt(p.style.top)- vx * dt+"px";
            p.style.left = parseInt(p.style.left) + vy * dt+"px";
            vx *= frict;
            vy *= frict;
            outOfBorders();outOfBordersBullets();outOfBordersBoulder();
      }
      var x,y,W,H;
      function outOfBorders(){
        H = window.innerWidth;
        W = window.innerHeight;
        x = p.style.top;
        y = p.style.left; 
        if(parseInt(x) > W){p.style.top = parseInt(x) - parseInt(W)+"px";}
        if(parseInt(x) < 0){p.style.top = parseInt(W)+"px";}
        if(parseInt(y) > H){p.style.left = parseInt(y) - parseInt(H)+"px";}
        if(parseInt(y) < 0){p.style.left = parseInt(H)+"px";}
      }
/* _______________________________________ Game Start _______________________________________ */
    var level=1;
    function newLevel(){
      for (var i = 1; i < level*2+2; i++) {
        createBoulder();
      }
      level++;
      end("up");
    }
    
    var health=3;
    function end(upOrDown){
      if (upOrDown=="up") {
        health++;  
      }else if (upOrDown=="down"){  
        health--;
      }
      switch (health) {
          case 3:
            document.getElementById("player").style.borderColor="transparent transparent #eaeaea99 transparent";
            break;
          case 2:
            document.getElementById("player").style.borderColor="transparent transparent #eaeaea87 transparent";
            break;
          case 1:
            document.getElementById("player").style.borderColor="transparent transparent #eaeaea50 transparent";
            break;
          case 0:
            alert("game over"); 
            document.getElementById("player").remove();
            break;
          default:
            document.getElementById("player").style.borderColor="transparent transparent #eaeaea transparent";
            break;
      }
    }
	 </script>
	</body>
</html>


