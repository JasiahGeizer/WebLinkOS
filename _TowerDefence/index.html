<!DOCTYPE html>

<html>
	<head>
		<meta charset="UTF-8">
		<style>/*
			To Do:

				- balance game difficulty - make harder - increase tower health & decrease damage/attack speed
				- make enemies walk faster at harder levels

				- update all tower descriptions for upgrade screen

				- play animation at speed of attack (restart animation)

				- increase tower speed cost by damage potential
				
				- make bullet color = tower color

			Planned:
				~ add buttons 1 to 9 as shortcuts for towers?
				~ show slight design change on tower attack upgrade?
				~ add button to speed everything up (replace greyed out start button with ">>" for fast-forward)
				~ make existing towers movable (for a fee)
				~ add randomness to path position
				~ design towers/enemys as pngs 
				~ add sound / music / mute btn
				~ add mutiple maps (new path layout/design - new playfield background)
				~ explain how different types inter-play with each other?

			Bugs:
				- change menu to event.stopPropagation() instead of variable
				- stop upgrade screen hiding on upgrade button press
				- list type of onfield tower onclick in previewbox
				- fix type error bug
				- fix towers only attacking 1 at a time
				- when clicked on a tower with upgrade you can't afford, if you get the money, it stays greyed out
				- after tower destroys bullet and gets money, previously unafordable items stay greyed out
				- (!!) more bullets shoot when more enemies on the field
					- need to add variable counter that spaces shots out - like first 4 towers 

			Releases:
				- 0.1: 
					Menu and playfield created in div, 
					selectable elements in menu, able to unselect items from menu, 
					working preview box, create selected item on mouse click, 
					if price > income - make unclickable
				- 0.2: 
					Show and updateable price, 
					Box greys out if can't afford-after each click, 
					if can't afford selected box - it goes red, 
					change box selection - they stay the correct color, 
					buildings colored & 50px square, Fixed: when deselect & click - check if null before placement, 
					Fix: can adjust browser window after placement, 
					can only can place inside playfield, 
					hide preview if out of playfield, 
					preview shows actual color from data attribute
				- 0.3: 
					theme'd all items w/ color & name, 
					adjusted prices (grouped by level), 
					added enemy: spawn/design/basic movement/end goal, 
					added go button, 
					lives and level variable/text added, 
					lives decrease on reaching the edge, 
					game over detected on 0 lives, 
					enemies given random top position within 50px of border
				- 0.4: 
					Start button greys out & increments next level, 
					hide preview hover on menu deselect, 
					made towers clickable, 
					fix: only click on tower not whole playfield. 
					Fix: select 1 tower at a time, 
					option to delete selected tower, 
					only show delete when tower's selected, 
					changed menu btn bg to color, 
					changed select color change to box shadow, 
					added collsision detection between path and new towers, 
					prevent new towers from being placed over paths, enemies follow path, 
					enemy spawns on start, 
					start button resets on game win, 
					Fix: unbuyable items disable, 
					fixed preview box size/position, 
					added dmg/rng/spd to preview box 
					dmg/rng/spd/description change in preview box with menu selection
				- 0.5:
					added range preview
					range preview visibility toggles w/ tower preview
					range preview - on tower field click - set to position
					if deselected - hide preview & deselect
					hide stats in previewbox on playfield tower click
					working upgrade buttons
					upgrading save to tower dataset
				- 0.6:
					press escape to unclick tower and remove selection
					description updates on playfield tower click
					price shows in upgrade options
					cost increases with each upgrade
					price disables if too expensive
					on playfield tower deselect - empty previewbox
					range onfieldclick adjusts to div rng size  
					preview range adjusts to div rng size
					range updates instantly on upgrade
					fixed: it tried to read preview when unclicked
				- 0.7:
					overflow hidden - fix range preview past border giving scrollbar, +no scroll bug
					fixed previewhovr overlapping menu
					set max range - greys out, stops purchase, shows "max in text field"
					enemy spawn at set interval
					enemy spawned from pre-set array
					preview shows next levels enemys
					added style to preview box
				- 0.8:
					deselecting on menu shows next round spawn preview
					increased enemy size
					enemy has health bar
					detect if enemy within tower range
					health bar decreases on attack
					enemy removed if no health left
					attack range fixed
					towers animate
				- 0.9:
					dynamic health vars & bars for enemy  
					enemy health is random, but max potential increase each level
					changed enemy hit from color change to white inset boxshadow
					enemy hit animation stops out of tower range
					press enter to start
				- 1.0:
					towers and enemys cycle animation on each attack
					styled tower animations
					fixed game ending if you kill all enemies before next one spawns
					fixed start double press to prevent next level bug
					tower attack speed = speed variable
					upgrading tower speed increase speed 
					increased cost of tower speed upgrade
					revenue increase (based on enemy starting health) for each enemy killed
					bug fixed: no longer removes "at max on deselct and reselect"
				- 1.1: 
					changed btn press if/then to case 
					added esc/del to sell
					cost of tower shows in dataset
					sell button gives listed money back & updates income/options
					added (non-working) move button
				- 1.2:
					show cost in preview
					type 5 towers rotate to face enemy
					type 5 towers spawn bullets
					bullets move and follow rotation
					tower rotation is animated 

			*/
		</style>
		<title>Tower Defence</title>
		<style type="text/css">
			html, body {
				overflow: hidden;
				height: 99%;
				user-select: none;
				-moz-user-select: none;
				background-color: #383838;
				font-family: monospace;
				color:white;	
			}			
			.grouped{
				position: relative;
				width: 700px;
				height: 600px;
				top: 50px;
				left: 50%;/*margin:0 auto;*/
				margin-left:-350px;
				border-radius: 3px;
				box-shadow: 0px 0px 25px #0c0c0c;
				color: white;		
				display: flex;
			}
			.menu{
				position: relative;
				width: 125px;
				height: 600px;
				border-radius: 3px;
				box-shadow:  0px 0px 5px black;
				background: #485779;
				padding-left: 5px; 
				z-index: 10;
			}
			.field{
				position: relative;
				width: 555px;
				height: 590px;
				margin-left: 10px;
				
				border-radius: 3px;
				box-shadow:  0px 0px 5px black;
				background: mediumseagreen;	
				text-align: center;
				z-index: 1;
			}
			ul{
				list-style: none;
		        margin:0px;
		        padding:0px;
		        border: 0px;
		        padding-top: 5px;
		        margin-left: 5px;
			}
			li {
				display: inline-table;
				box-shadow: inset 0px 0px 1px 1px black;
				width: 54px;
				height: 40px;
				list-style-type: none;
		        list-style-position:inside;
		        margin: -4px; 
		        margin-top: 3px;
		        padding-left: 5px; 
		        padding-top: 5px; 
			}
			.enemyStyle{
				width: 30px;
			    height: 30px;
			    position: absolute;
			    border-radius: 30px;
			    text-align: center;
			    line-height: 30px;
			    z-index: 10;
			    transition:all 0.2s; /*smooth movement*/
			}
			.button{
				width: 116px;
				height: 44px;
				text-align: center;
				font-size: 25px;
				background: green;
				line-height: 44px;
				padding: 0px;
			}
			.button:hover{
				box-shadow: 0px 0px 3px black, inset 0px 0px 0px 1px black;
			}
			.button:active{
				box-shadow: inset 0px 0px 3px 1px black, inset 0px 0px 0px 1px black;
			}
			.path{
				background: palegoldenrod;
				width: 50px;
				height: 50px;
				position: absolute;
				z-index: 0;
			}
			p{
				margin: 0px;
			}
			#upgrades{
				display: none;

			}
			.upgradeBox{
				box-shadow: 0px 0px 0px 1px black;
				background: orange;
				width: 100px;
				margin-top:5px;
				color: black;
				padding-left: 15px;
				height: 20px;
				line-height: 20px;
				margin-left: -4px;
			}
			.upgradeBox:hover{
				box-shadow: 0px 0px 2px 1px black;
				background: #ffd400;
				color: black;
			}
			.upgradeBox:active{
				box-shadow: inset 0px 0px 1px 1px black;
				background: #ff6a00;
			}
			#upgrade1{
				margin-top: 10px;
			}
			#previewTXT{
				background: darkslategrey;
				padding-top: 4px;
				margin-left:-4px;
				box-shadow:0px 1px black;
				display: inline-block;
				width: 112px;
				padding-left: 4px;
			}
			#previewBox{
				font-size: 12px;
				line-height: 12px;
				background: brown;
				padding-top: 5px;
				padding-bottom: 5px;
				margin-left:-4px;
				box-shadow: 1px 1px black;
				padding-left: 4px;
				width: 111px;
			}
			@keyframes pulse1 {
				0% {transform: scale(1.2, 1.2);box-shadow: 0 0 30px 30px grey;}
				70% {box-shadow: 0 0 30px 30px rgba(0, 0, 0, 0);}
				100% {box-shadow: 0 0 0 0 rgba(0, 0, 0, 0);}
			}
			@keyframes pulse2 {
				0% {box-shadow: 0 0 0 0 red;}
				70% {box-shadow: 0 0 0 30px rgba(0, 0, 0, 0);}
				100% {box-shadow: 0 0 0 0 rgba(0, 0, 0, 0);}
			}
			@keyframes pulse3 {
				0% {box-shadow: 0 0 0 0 #a7725e;}
				70% {box-shadow: 0 0 0 30px rgba(0, 0, 0, 0);}
				100% {box-shadow: 0 0 0 0 rgba(0, 0, 0, 0);}
			}
			@keyframes pulse4 {
				0% {box-shadow: 0 0 0 0 lightblue;}
				70% {box-shadow: 0 0 0 30px #add8e600}
				100% {box-shadow: 0 0 0 0 rgba(0, 0, 0, 0);}
			}
			@keyframes pulse5 {
				0% {box-shadow: 0 0 0 0 black;}
				70% {border-radius:15px;box-shadow: 0 0 30px 30px rgba(0, 0, 0, 0);}
				100% {box-shadow: 0 0 0 0 rgba(0, 0, 0, 0.1);}
			}
			@keyframes pulse6 {
				0% {box-shadow: inset 0 0 0 30px #ffffff7a;}
				40% {box-shadow: inset 0 0 0 30px #ffffff7a;}
				100% {box-shadow: inset 0 0 0 0 #00000000}
			}
			.optionButton{
				    background: red;
				    font-size: 13px;
				    width: 54px;
				    height: 44px;
				    line-height: 15px;
				    padding-left: 5px;
				    padding-top: 5px;
				    text-align: left;
				    display: inline-grid;
			}
			.bullet{
				width:10px;
				height: 10px;
				position: absolute;
				border-radius: 10px;
				z-index: 10;
				background: black;
				transition:all 0.2s;
			}
		</style>
	</head>

	<body onload="" onkeydown="btnPress(event)" onkeyup="">
		Tower Defence
		<i>
			<br>
				enter to start level, esc to remove current selection, delete/backspace to sell
		</i>
		<div class="grouped" style="background: #383838">
			<div id="bg" class="menu" onclick="removeSelected(event)">
				Menu - level: <span id="level"> 1</span>
				<p id="income" style="margin: 0px; margin-top: 2px;">$: 1</p>
				<p id="lives" style="margin: 0px; margin-bottom: 2px;">â™¥: 20</p>

				<ul style="height: 580px;">
					<li id="1" onclick="bgChange(this.id);" data-price="12" data-color="#82858c">
						<span>Wind 1</span>
					</li>
					<li id="2" onclick="bgChange(this.id);" data-price="14" data-color="#d02013">
						<span>Fire 1</span>
					</li>
					<li id="3" onclick="bgChange(this.id);" data-price="16" data-color="#754432">
						<span>Earth 1</span>
					</li>
					<li id="4" onclick="bgChange(this.id);" data-price="20" data-color="#0072ff">
						<span>Water 1</span>
					</li>
					<li id="5" onclick="bgChange(this.id);" data-price="50" data-color="radial-gradient(circle, #82858c, #bababb)">
						<span>Wind 2</span>
					</li>
					<li id="6" onclick="bgChange(this.id);" data-price="55" data-color="radial-gradient(circle, #ff8e82, #ff1800)">
						<span>Fire 2</span>
					</li>
					<li id="7" onclick="bgChange(this.id);" data-price="60" data-color="radial-gradient(circle, #ba8e7e, #795548)">
						<span>Earth 2</span>
					</li>
					<li id="8" onclick="bgChange(this.id);" data-price="65" data-color="radial-gradient(circle, #7eb8ff, #0072ff)">
						<span>Water 2</span>
					</li>
					<li id="9" onclick="bgChange(this.id);" data-price="80" data-color="linear-gradient(to left top, #82858c  30%, #d02013)">
						<span>Wind / Fire</span>
					</li>
					<li id="10" onclick="bgChange(this.id);" data-price="85" data-color="linear-gradient(to left top, #795548 30%, #0072ff)">
						<span>Earth / Water</span>
					</li>
					<li id="11" onclick="bgChange(this.id);" data-price="99" data-color="radial-gradient(circle, #ac59ff, #4c0098)">
						<span>Void</span>
					</li>
					<li id="12" onclick="bgChange(this.id);" data-price="160" data-color="radial-gradient(circle, black, grey)">
						<span>Dark Matter</span>
					</li>

					<div style="margin: 0px;bottom: 230px;position: absolute;">
						<li class="optionButton" id="delete" onclick="removeTower();" style="visibility: hidden;">Sell $0</li>
						<li class="optionButton" id="delete2" onclick="removeTower();" style="visibility: hidden;background: orange">Move $20</li>
					</div>
					<ul style="margin: 0px;bottom: 60px;position: absolute;" onclick="updateRevenue()">
						<li style="padding-top:1px;width: 112px;height: 158px;background: crimson;"><span style="width: 111px" id="previewTXT">Preview</span>
							<i><p id="previewBox">This is a description of what the item does.</p></i>
							<p id="dmgBox"> 
								<span id="dmg1">ðŸ’¨ 10 / ðŸ”¥ 10 </span> 
								<br> 
								<span id="dmg2">ðŸ—¿ 10 / ðŸŒŠ 10</span> 
							</p>
							<p id="rngBox">ðŸŽ¯: 10</p>
							<p id="speedBox">âš¡: 10</p>
							<div id="upgrades">
								<div class="upgradeBox" id="upgrade1" onclick="upgrade(1, this)">ðŸŽ¯</div>
								<div class="upgradeBox" id="upgrade2" onclick="upgrade(2, this)">âš¡</div>
							</div>
							
						</li>
					</ul>
					<div style="margin: 0px;bottom: 10px;position: absolute;">
						<li class="button" id="start" onclick="start();">Start</li>
					</div>
				</ul>
			</div>
			<div class="field" id="plyfld" onclick="createInput(event)" onmousemove="previewHovr(event)">
				Playfield

				<!--
					 onmouseleave="previewHide()"-->

					<div id="preview" style="width: 50px; height: 50px; background: hotpink; position: fixed; left: 718px; top: 617px;opacity: 0.75;z-index: 10;">1</div>
					<div id="preview2" style="border-radius: 600px; width: 150px; height: 150px; background: #e4145b; position: fixed; left: 668px; top: 570px;opacity: 0.2;z-index: 9;"></div>

					<div id="enemyContainer">
						
					</div>

					<div id="pathContainer">
						<div class="path" style="left:0px;width: 200px;top: 30px;"></div>
						<div class="path" style="left: 150px;top: 30px;height: 450px;"></div>
						<div class="path" style="left: 150px;top: 430px;width: 200px;"></div>
						<div class="path" style="left: 300px;top: 200px;height: 280px;"></div>
						<div class="path" style="left: 300px;top: 200px;width: 200px;"></div>
						<div class="path" style="left: 450px;top: 200px;height: 390px;"></div>
					</div>

					<div id="towerContainer">
						
					</div>

					<div id="bulletContainer">
						
					</div>
			</div>
		</div>

		<script type="text/javascript">
			var selected=1;
			var liFired=false;
			var revenue=100;
			var lives=20;
			var level=1;
			var boxInfo;

			function bgChange(that){ //menu item selection
				if (document.getElementById("delete").style.visibility="visible") {
					unClickTower();
				}
				//document.getElementById(selected).style.background="orange";
				for (var i = 12; i >= 1; i--) {
					document.getElementById(i).style.background=document.getElementById(i).dataset.color;
				}

				//document.getElementById(that).style.background="#de7100";

				selected=that;
				liFired=true;
				//document.getElementById("previewBox").innerHTML=selected;
				
				boxInfo = getBoxInfo(that);
				//dmg1 // dmg2 // rngBox // speedBox
				document.getElementById("previewBox").innerHTML=boxInfo[0];
				document.getElementById("dmg1").innerHTML="ðŸ’¨ "+boxInfo[1]+" / ðŸ”¥ "+boxInfo[2];
				document.getElementById("dmg2").innerHTML="ðŸ—¿ "+boxInfo[3]+" / ðŸŒŠ "+boxInfo[4];
				document.getElementById("rngBox").innerHTML="ðŸŽ¯: "+boxInfo[5];
				document.getElementById("speedBox").innerHTML=" âš¡: "+boxInfo[6];

				availableCoin();

				document.getElementById("previewTXT").innerHTML="Preview / $"+document.getElementById(that).dataset.price;
			}
			function removeSelected(event){ //menu deselection
				if (towerClicked!=null) {towerClicked.style.boxShadow=null;}
				document.getElementById("delete").style.visibility="hidden";
				document.getElementById("delete2").style.visibility="hidden";
				unpreviewUpgrades("that");
				if (liFired==false) {
					for (var i = 12; i >= 1; i--) {
						document.getElementById(i).style.background=document.getElementById(i).dataset.color;
					}
					selected=null;
					document.getElementById("preview2").style.visibility="hidden";
					document.getElementById("preview").style.visibility="hidden";
					document.getElementById("previewTXT").innerHTML="Preview";
					previewDeselect();
				}else{
					//console.log("clck");
				}
				liFired=false;
				//document.getElementById("previewBox").innerHTML=selected;
				availableCoin();
				//event.stopPropagation(); //todo: not working
			}
			var rect2;
			var rect1;
			function checkPlacement(newthing){ //check if tower is overlapping with path & stop it
				var x = document.getElementById("pathContainer").querySelectorAll(".path");

				rect1 = newthing.getBoundingClientRect()
				
				for (i = 0; i < x.length; i++) {

				  	rect2 = x[i].getBoundingClientRect();

					if (rect1.x < rect2.x + rect2.width &&
					   rect1.x + rect1.width > rect2.x &&
					   rect1.y < rect2.y + rect2.height &&
					   rect1.y + rect1.height > rect2.y) { // collision detected!
						revenue=parseInt(revenue)+parseInt(newthing.dataset.price); //give back money spent
						newthing.remove(); //remove object
						break;
						//todo: change from deleting object to preventing object from being placed.
					}
				}
			}
			function createInput(event){
				if (selected!==null) {
					if (revenue-document.getElementById(selected).dataset.price>=0) {
						if ((event.clientX-(window.innerWidth/2-190)<=510) && (event.clientY-115<541)) {
							if ((event.clientX-(window.innerWidth/2-190)>=0) && (event.clientY-115>=0)) {	
							  var newthing = document.createElement("div");    
							  newthing.innerHTML = selected;
							  newthing.style.width="50px";
							  newthing.style.height="50px";
							  newthing.style.zIndex="10";
							  newthing.className="tower";
							  newthing.style.transition="all 0.2s";
							
							  var stats = getBoxInfo(selected);
							  newthing.dataset.id=selected;
							  newthing.dataset.rng=stats[5];
							  newthing.dataset.spd=stats[6];
							  newthing.dataset.cost=document.getElementById(selected).dataset.price;
							  newthing.dataset.spdr=15-parseInt(newthing.dataset.spd);

							  var size = newthing.dataset.rng*13; //preview size

							  newthing.style.background=document.getElementById(selected).dataset.color;
							  newthing.setAttribute("onclick", "playClicked(this)");                  
							  document.getElementById("towerContainer").appendChild(newthing); // Your existing code


							  // get the coordinates of the mouse
							  var x = event.clientX-(window.innerWidth/2-190);     // get the horizontal coordinate
							  var y = event.clientY-115;   // get the vertical coordinate

							  // position newthing using the coordinates
							  newthing.style.position = "absolute"; // fixes el relative to page. Could use absolute.
							  newthing.style.left = x + "px";
							  newthing.style.top = y + "px";
							  newthing.dataset.price=document.getElementById(selected).dataset.price;
								
							  checkPlacement(newthing);

							  revenue=revenue-document.getElementById(selected).dataset.price;
							  document.getElementById("income").innerHTML="$: "+revenue;
							}
						}
					}
				}else if (towerClicked!=null) {
						unClickTower(); //need to click twice to remove (it autoclicks with div) - int that increments twice

				}
				availableCoin();
			}

			var tempRevenue;
			
			function bgUpdate(){ //menu item selection
				for (var i = 12; i >= 1; i--) {
					if (revenue-document.getElementById(i).dataset.price>=0) {
						document.getElementById(i).style.background=document.getElementById(i).dataset.color;
					}else{
						document.getElementById(i).style.background="#2d3954";
					} //need condition for selected & unavalable 
				}
			}

			function availableCoin(){ //menu item selection
				for (var i = 12; i >= 1; i--) {
					tempRevenue = document.getElementById(i).dataset.price;

					if (tempRevenue>revenue) { //can you afford?
						if (i==selected) { //is it currently selected & can afford
							document.getElementById(i).style.background="#485779";
							document.getElementById(i).style.boxShadow="inset 0px 0px 10px 3px black";
							document.getElementById("preview").style.background = document.getElementById(i).dataset.color;
						}else{
							document.getElementById(i).style.background="#2d3954";
							document.getElementById(i).style.boxShadow=null;
						}

					} else if (parseInt(i)!==parseInt(selected)){ //if can afford & not selected
						document.getElementById(i).style.boxShadow=null;

					} else if (parseInt(i)==parseInt(selected)){ //if can't afford & currently selected
						document.getElementById(i).style.boxShadow="inset 0px 0px 10px 3px black";
						document.getElementById("preview").style.background = document.getElementById(i).dataset.color;
					}
				}
			}
			var typePrev2;
			function previewHovr(event){ //hover over game field - placement preview 
				if (document.getElementById("preview").style.visibility=="hidden" && selected!=null) {
					document.getElementById("preview").style.visibility="visible"
					document.getElementById("preview2").style.visibility="visible";
				}
				if (document.getElementById("delete").style.visibility=="hidden") {

					if ((event.clientX-(window.innerWidth/2-190)<=515) && (event.clientY-115<546) && (event.clientX-(window.innerWidth/2-190)>=-5) && (event.clientY-115>=-5) && selected!=null) {	
					var prev = document.getElementById("preview");
					var x = event.clientX-(window.innerWidth/2-190);     // get the horizontal coordinate
					var y = event.clientY-115;   // get the vertical coordinate

					// position newthing using the coordinates
					prev.style.position = "absolute"; // fixes el relative to page. Could use absolute.
					prev.style.left = x + "px";
					prev.style.top = y + "px";

					//range box//
					var prev2 = document.getElementById("preview2");
					var x = (event.clientX-(window.innerWidth/2-190)-50); // change 50 to variable for range
					var y = (event.clientY-115)-50;   // change 50 to variable for range

					// position newthing using the coordinates

					typePrev2=getBoxInfo(selected);
					
					prev2.style.position = "absolute";
					prev2.style.left = x+74-((typePrev2[5]*13+100)/2)+ "px";
					prev2.style.top = y+74-((typePrev2[5]*13+100)/2) + "px";

					prev2.style.width = typePrev2[5]*13+100+"px";
					prev2.style.height = typePrev2[5]*13+100+"px";

					}else{
						document.getElementById("preview2").style.visibility="hidden";
						document.getElementById("preview").style.visibility="hidden";
					}
				}
			}

			var sizeHLTH=44; 
			function enemySpawn(type){
				sizeHLTH=Math.floor(Math.random() * (level*3)+44);

				var enemy = document.createElement("div");    
				enemy.innerHTML = document.getElementById(type).id;
				enemy.className = "enemyStyle";
				enemy.style.left="-65px";
				enemy.style.top=Math.floor((Math.random() * 20) + 30)+"px";
				enemy.style.background=document.getElementById(type).dataset.color;
				enemy.dataset.pos=1;
				enemy.dataset.health=sizeHLTH;
				enemy.style.width="44px";
				enemy.style.height="44px";
				enemy.dataset.type=type;

				document.getElementById("enemyContainer").appendChild(enemy); // Your existing code

				var enemyChild = document.createElement("div");
				enemyChild.style.background="black";
				enemyChild.style.height="3px";
				enemyChild.style.width=sizeHLTH+"px";
				enemyChild.style.left=-(sizeHLTH/2)+22+"px";
				enemyChild.style.top="-37px";
				enemyChild.style.position="relative";
				enemyChild.style.boxShadow="inset "+sizeHLTH+"px 0px red";
				enemy.appendChild(enemyChild);
			}

			function moveEnemies(){ //need to keep on path
				bulletMove();
				var x = document.getElementById("enemyContainer").querySelectorAll(".enemyStyle");
				if (x.length==0 && allSpawned==true) {levelWin();}//todoasdf
				var i;
				for (i = 0; i < x.length; i++) {

					switch(x[i].dataset.pos){
						case "1":
							x[i].style.left=parseInt(x[i].style.left)+10+"px";
							if (parseInt(x[i].style.left)>=150) {x[i].dataset.pos="2";}
							break;
						case "2":
							x[i].style.top=parseInt(x[i].style.top)+10+"px";
							if (parseInt(x[i].style.top)>=430) {x[i].dataset.pos="3";}
							break;
						case "3":
							x[i].style.left=parseInt(x[i].style.left)+10+"px";
							if (parseInt(x[i].style.left)>=305) {x[i].dataset.pos="4";}
							break;
						case "4":
							x[i].style.top=parseInt(x[i].style.top)-10+"px";
							if (parseInt(x[i].style.top)<=210) {x[i].dataset.pos="5";}
							break;
						case "5":
							x[i].style.left=parseInt(x[i].style.left)+10+"px";
							if (parseInt(x[i].style.left)>=450) {x[i].dataset.pos="6";}
							break;
						case "6":
							x[i].style.top=parseInt(x[i].style.top)+10+"px";
							if (parseInt(x[i].style.top)>=575) {
						  		x[i].remove();
						  		hit();
						  	}
							break;
					}
				}
				towerShoot();
			}

			function hit(){ //player loses a life
				lives--;
				document.getElementById("lives").innerHTML="â™¥: "+lives;
				console.log("Someone made it through! 1 life point lost");
				if (lives<=0) {end();}
			}

			function end(){ //end game
				console.log("Game Over");
				//to do: change start to restart
				//to do: save highscore to data - show previous highscore?
			}

			var started=false;
			var gameTimer;
			function start(){ //start level
				if (started==false) {
					allSpawned=false;
					document.getElementById("level").innerHTML=level;
					document.getElementById("start").style.background="darkgrey";
					document.getElementById("start").style.color="grey"
					//enemySpawn(1);enemySpawn(12);
					enemySpawnLoop(level);
					//gameTimer = setInterval(moveEnemies, 100);
				}
				started=true;
			}
			var LevelEnemy;
			var SpawnTimer;
			var spawnIncr;
			var allSpawned=true;
			function enemySpawnLoop(lvl){ //initiate enemy spawn timer
				LevelEnemy=getLevelInfo(lvl);
				
				spawnIncr = 1;
				SpawnTimer = setInterval(enemySpawnLoop2, 1000, spawnIncr);
			}
			function enemySpawnLoop2(i){ //send the correct enemy type to the spawner
				if (spawnIncr>=LevelEnemy.length) {
					clearInterval(SpawnTimer);
					allSpawned=true;
				}
				enemySpawn(LevelEnemy[spawnIncr-1]);
				if (spawnIncr==1) {
					gameTimer = setInterval(moveEnemies, 100);
				}
				spawnIncr++;
			}

			function levelWin(){
				level++;
				console.log("nextlvl");
				revenue=revenue+(100+10*level);
				document.getElementById("income").innerHTML="$: "+revenue;
				clearInterval(gameTimer);
				started=false;
				document.getElementById("start").style.background="green";
				document.getElementById("start").style.color=null;
				bgUpdate();
				unClickTower();
				clearBullets();
			}

			var towerClicked=document.getElementById(1);
			function playClicked(that){

				updateStats(that);

				removeSelected(event);
				//if (towerClicked!=null) {towerClicked.style.boxShadow=null;}
				
				//-Need to create bool for follow mouse vs stick to tower - need fix if mouseleave dont hide -//
				document.getElementById("preview2").style.visibility="visible";
				document.getElementById("preview2").style.left=parseInt(that.style.left);
				//--//


				//turn preview box into function that recieves color, price variables
				that.style.boxShadow="0px 0px 0px 2px red";
				document.getElementById("delete").style.visibility="visible";
				document.getElementById("delete2").style.visibility="visible";
				unpreviewUpgrades("that");
				towerClicked=that;

					updateRNG(that);

				previewUpgrades(that);
				event.stopPropagation();
			}
			function updateRNG(that){
					var prev2 = document.getElementById("preview2");
					var x = (parseInt(that.style.left)+24-((that.dataset.rng*13+100)/2)); // checkange 50 to variable for range
					var y = (parseInt(that.style.top))+24-((that.dataset.rng*13+100)/2);   // change 50 to variable for range

					// position newthing using the coordinates
					prev2.style.position = "absolute";
					prev2.style.left = x + "px";
					prev2.style.top = y + "px";

					prev2.style.width=that.dataset.rng*13+100+"px";
					prev2.style.height=that.dataset.rng*13+100+"px";
			}
			function previewUpgrades(that){
				//console.log(that);
				if (document.getElementById("delete").style.visibility!=="hidden") {					
					document.getElementById("dmgBox").style.display="none";
					document.getElementById("rngBox").style.display="none";
					document.getElementById("speedBox").style.display="none";

					//todo: show upgrade box
					document.getElementById("upgrades").style.display="inline";
				}
			}
			function unpreviewUpgrades(that){
				if (document.getElementById("delete").style.visibility!=="visible") {					
					document.getElementById("dmgBox").style.display="inline";
					document.getElementById("rngBox").style.display="block";
					document.getElementById("speedBox").style.display="block";

					//todo: hide upgrade box
					document.getElementById("upgrades").style.display="none";
				}
			}

			function upgrade(that, that2){
				var amount;
				if (that==1 && (parseInt(tempID.dataset.spd)<=14)){
					if (revenue-(parseInt(tempID.dataset.spd)*5)>0){
						amount=(tempID.dataset.spd*5);
						revenue=revenue-amount; //todo: get exact price
						tempID.dataset.cost=parseInt(tempID.dataset.cost)+amount;
						tempID.dataset.spd=parseInt(tempID.dataset.spd)+1;
					}

				}else if (that==2) { //is rng upgrade too expensive or at max?
					if (revenue-(parseInt(tempID.dataset.rng)*1.5)>0 && (parseInt(tempID.dataset.rng)<=97)){
							amount=(tempID.dataset.rng*1.5);	
							revenue=revenue-amount; //todo: get exact price
							tempID.dataset.cost=parseInt(tempID.dataset.cost)+amount;
							tempID.dataset.rng=parseInt(tempID.dataset.rng)+2;
					}
				}
				updateStats2(tempID);
				updateRNG(towerClicked);
				updateRevenue();
				availableCoin();
				event.stopPropagation();
			}

			function unClickTower(){
				document.getElementById("delete").style.visibility="hidden";
				document.getElementById("delete2").style.visibility="hidden";
				document.getElementById("preview2").style.visibility="hidden";
				unpreviewUpgrades("that");
				towerClicked.style.boxShadow=null;
				//if delete visible > make invisible
				previewDeselect();
			}

			function removeTower(){ //delete tower
				//create a new dataset called "value" - add to each each upgrade?
				//get cost of original tower - call tower values?
				//add in upgrade costs - division required?
				//mutiple by 0.8
				//add back that value
				revenue=parseInt(revenue)+Math.round(parseInt(towerClicked.dataset.cost)*0.8);
				updateRevenue();
				towerClicked.remove();
				removeSelected(event);
				document.getElementById("delete").style.visibility="hidden";
				document.getElementById("delete2").style.visibility="hidden";
				unpreviewUpgrades("that");
			}

			function updateRevenue(){
				document.getElementById("income").innerHTML="$: "+revenue;
			}

			var tempID;
			var test;
			function updateStats(that){
				document.getElementById("delete").innerHTML="Sell: $"+Math.round(that.dataset.cost*0.8);
				document.getElementById("upgrade1").innerHTML="$"+(that.dataset.spd*5)+" "+" âš¡ "+that.dataset.spd+"+"+1;
				document.getElementById("upgrade2").innerHTML="$"+(that.dataset.rng*1.5)+" "+" ðŸŽ¯ "+that.dataset.rng+"+"+2;
				//document.getElementById("previewBox").innerHTML=that[0];

				tempID=that;


				test = getBoxInfo(that.dataset.id);
				document.getElementById("previewBox").innerHTML=test[0];

				if ((parseInt(that.dataset.spd)*5)>revenue && (parseInt(that.dataset.spd)<=14)) {
					document.getElementById("upgrade1").style.background="grey";
				}else{
					if (parseInt(that.dataset.spd)<=14) { 
						document.getElementById("upgrade1").style.background="orange"; 
					}else{
						document.getElementById("upgrade1").style.background="grey"; 
						document.getElementById("upgrade1").innerHTML="AT MAX";
					}
				}


				if ((parseInt(that.dataset.rng)*1.5)>revenue && parseInt(that.dataset.rng)<=97) {
					document.getElementById("upgrade2").style.background="grey";
				}else{
					if (parseInt(that.dataset.rng)<=97) { 
						//console.log(that.dataset.rng);
						document.getElementById("upgrade2").style.background="orange"; 
					}else{
						document.getElementById("upgrade2").style.background="grey"; 
						document.getElementById("upgrade2").innerHTML="AT MAX";
					}
				}
			}
			function updateStats2(that){
				document.getElementById("delete").innerHTML="Sell: $"+Math.round(that.dataset.cost*0.8);
				document.getElementById("upgrade1").innerHTML="$"+(that.dataset.spd*5)+" "+" âš¡ "+that.dataset.spd+"+"+2;
				document.getElementById("upgrade2").innerHTML="$"+(that.dataset.rng*1.5)+" "+" ðŸŽ¯ "+that.dataset.rng+"+"+2;
				//document.getElementById("previewBox").innerHTML=that[0];

				tempID=that;

				if ((parseInt(that.dataset.spd)*5)>revenue && (parseInt(that.dataset.spd)<=14)) {
					document.getElementById("upgrade1").style.background="grey";
				}else{
					if (parseInt(that.dataset.spd)<=14) { 
						document.getElementById("upgrade1").style.background="orange"; 
					}else{
						document.getElementById("upgrade1").style.background="grey"; 
						document.getElementById("upgrade1").innerHTML="AT MAX";
					}
				}

				if ((parseInt(that.dataset.rng)*1.5)>revenue && parseInt(that.dataset.rng)<=97) {
					document.getElementById("upgrade2").style.background="grey";
				}else{
					if (parseInt(that.dataset.rng)<=97) { 
						document.getElementById("upgrade2").style.background="orange"; 
					}else{
						document.getElementById("upgrade2").style.background="grey"; 
						document.getElementById("upgrade2").innerHTML="AT MAX";
					}
				}
			}

			/*on startup*/
				availableCoin();
				bgUpdate();
				updateRevenue()
				//document.getElementById(1).style.background="#de7100";
			/*----------*/


			function getBoxInfo(type){
				switch(parseInt(type)){
					case 1: //wind 1
						return [
							"Manipulate the air around the tower causing suffocation.", //description
							5, 0, 0, 0,//dmg wind, fire, earth, water
							4, //rng
							10 //speed
						];
						break;
					case 2: //fire 1
						return [
							"Fast-moving directional fire strike.", //description
							0, 5, 0, 0,//dmg wind, fire, earth, water
							4, //rng
							10 //speed
						];
						break;
					case 3: //earth 1
						return [
							"Generates a wave of rocks from the ground to do great damage.", //description
							0, 0, 5, 0,//dmg wind, fire, earth, water
							4, //rng
							10 //speed
						];
						break;
					case 4: //water 1
						return [
							"Rain acid surrounding the tower.", //description
							0, 0, 0, 5,//dmg wind, fire, earth, water
							4, //rng
							10 //speed
						];
						break;
					case 5: //wind 2
						return [
							"wind 2 description", //description
							7, 1, 0, 1,//dmg wind, fire, earth, water
							6, //rng
							4 //speed
						];
						break;
					case 6: //fire 2
						return [
							"fire 2 description", //description
							1, 7, 1, 0,//dmg wind, fire, earth, water
							6, //rng
							4 //speed
						];
						break;
					case 7: //earth 2
						return [
							"earth 2 description", //description
							0, 2, 7, 2,//dmg wind, fire, earth, water
							6, //rng
							4 //speed
						];
						break;
					case 8: //water 2
						return [
							"water 2 description", //description
							2, 0, 2, 7,//dmg wind, fire, earth, water
							6, //rng
							4 //speed
						];
						break;
					case 9: //wind fire
						return [
							"windfire description", //description
							8, 8, 0, 0,//dmg wind, fire, earth, water
							6, //rng
							5 //speed
						];
						break;
					case 10: //earth water
						return [
							"earthwater description", //description
							0, 0, 8, 8,//dmg wind, fire, earth, water
							6, //rng
							5 //speed
						];
						break;
					case 11: //all 1
						return [
							"void description", //description
							6, 6, 6, 6,//dmg wind, fire, earth, water
							8, //rng
							7 //speed
						];
						break;
					case 12: //all 2
						return [
							"dark matter description", //description
							10, 10, 10, 10,//dmg wind, fire, earth, water
							10, //rng
							10 //speed
						];
						break;	
				}
			}

			function btnPress(event){

				switch(event.keyCode){
					case 27:
						if (document.getElementById("delete").style.visibility="visible") {
							unClickTower();
						}
						removeSelected(event);
						break;
					case 13:
						start();
						break;
					case 46:
					case 8:
						if (document.getElementById("delete").style.visibility="visible") {
							removeTower();
							unClickTower();
						}
					break;
				/*case 57: bgChange(10);break;
				case 49: bgChange(1);break;
				case 50: bgChange(2);break;
				case 51: bgChange(3);break;
				case 52: bgChange(4);break;
				case 53: bgChange(5);break;
				case 54: bgChange(6);break;
				case 55: bgChange(7);break;
				case 56: bgChange(8);break;
				case 57: bgChange(9);break;*/
					default:
						//console.log(event.keyCode);
						break;
				}
			}

			var levelText;
			function previewDeselect(){
				if (document.getElementById("delete").style.visibility=="visible") {
					//document.getElementById("dmg1").innerHTML="";
					//document.getElementById("dmg2").innerHTML="";
					//document.getElementById("rngBox").innerHTML="";
					//document.getElementById("speedBox").innerHTML="";
				}else{
					//todo: need to create a sum algorithm that adds up all the 1's, 2's, 3's, 4's in array
					// (!!) for loop - length of array - if = 1, new int++; || x4 total loops - one for each enemy type 
					// option 2: get array - if array[0] = 1, add emoji 1 to text box, loop for all emojis
					
					document.getElementById("previewBox").innerHTML="Enemy's spawning next level: ";
					document.getElementById("rngBox").innerHTML="";
					document.getElementById("speedBox").innerHTML="";
					document.getElementById("dmg1").innerHTML="";
					document.getElementById("dmg2").innerHTML="";

					levelText=getLevelInfo(level);
					for (var i = levelText.length - 1; i >= 0; i--) {
						switch(parseInt(levelText[i])){
							case 1:
								document.getElementById("dmg2").innerHTML=
								document.getElementById("dmg2").innerHTML+
								"ðŸ’¨";
								break;
							case 2:
								document.getElementById("dmg2").innerHTML=
								document.getElementById("dmg2").innerHTML+
								"ðŸ”¥";
								break;
							case 3:
								document.getElementById("dmg2").innerHTML=
								document.getElementById("dmg2").innerHTML+
								"ðŸ—¿";
								break;
							case 4:
								document.getElementById("dmg2").innerHTML=
								document.getElementById("dmg2").innerHTML+
								"ðŸŒŠ";
								break;
						}
					}

				}
			}


			function getLevelInfo(type){ //which enemy types to spawn
				switch(parseInt(type)){
					/*enemys: wind, fire, earth, water*/
					case 1: return [4,4];break;
					case 2: return [2,2]; break;
					case 3: return [2,2,4,4]; break;
					case 4: return [1,1]; break;
					case 5: return [1,1,3,3]; break;
					case 6: return [4,4,4,4,4]; break;
					case 7: return [2,2,2,2,2]; break;
					case 8: return [1,1,1,1,1,2,3,4]; break;
					case 9: return [1,1,1,2,2,2,3,3,3,4,4,4]; break;
					case 10: return [1,1,2,3,3,3,3,3,4]; break;
					case 11: return [4,4,4,4,4,4,4,4,4,4]; break;
					case 12: return [2,2,2,2,2,2,4,4,4,4,4,4]; break;
					case 13: return [1,1,1,1,1,1,1,1,1,1]; break;
					case 14: return [1,1,1,1,1,2,2,2,2,2,3,3,3,3,3,4,4,4,4,4]; break;
					default: return [1,2,3,4,1,2,3,4];break;
				}
			}


			//tower shoot div
				// get id - then put shoot type in switch function
				// each tower shoots differently (?) or a 8/2/2 ways to shoot
				// create div - bullet - set timer to go in direction of dataset.degree
					//bullet inhret tower dmg (or id to reference dmg)

					var dx,dy,distance;
			function towerShoot(){
				var x = document.getElementById("towerContainer").querySelectorAll(".tower");
				var y = document.getElementById("enemyContainer").querySelectorAll(".enemyStyle");

				for (var i3 = x.length - 1; i3 >= 0; i3--) {
					for (var ii = y.length - 1; ii >= 0; ii--) {

						if (x[i3].dataset.spdr>0) {
							x[i3].dataset.spdr=parseInt(x[i3].dataset.spdr)-1;
						}

						dx = parseInt(x[i3].style.left)-parseInt(y[ii].style.left);
						dy = parseInt(x[i3].style.top)-parseInt(y[ii].style.top);
						distance = Math.sqrt(dx * dx + dy * dy);

						//detect if they are within range of eachother
						
						//var x = (parseInt(that.style.left)+24-((that.dataset.rng*13+100)/2));

						
						if (distance < ((x[i3].dataset.rng*13)+50)/2 + parseInt(y[ii].style.width)) {
						    // collision detected!
						    //y[ii].style.background='#'+Math.random().toString(16).substr(2,6);
						    //x[i3].style.background='#'+Math.random().toString(16).substr(2,6);

						    //y[ii].classList.add("enemyAnimate1");


						    
						    

						    //animate tower attack
						    switch(parseInt(x[i3].dataset.id)){
						    	case 1:
						    		y[ii].style.animation = 'pulse6 0.2s';
						    		y[ii].addEventListener("animationend", listener, false);
						    		x[i3].style.animation ="pulse1 0.5s";
						    		towerAttacks(x[i3], y[ii]);
						    		break;
						    	case 2:
						    		y[ii].style.animation = 'pulse6 0.2s';
						    		y[ii].addEventListener("animationend", listener, false);
						    		x[i3].style.animation ="pulse2 0.5s";
						    		towerAttacks(x[i3], y[ii]);
						    		break;
						    	case 3:
						    		y[ii].style.animation = 'pulse6 0.2s';
						    		y[ii].addEventListener("animationend", listener, false);
						    		x[i3].style.animation ="pulse3 0.5s";
						    		towerAttacks(x[i3], y[ii]);
						    		break;
						    	case 4:
						    		y[ii].style.animation = 'pulse6 0.2s';
						    		y[ii].addEventListener("animationend", listener, false);
						    		x[i3].style.animation ="pulse4 0.5s";
						    		towerAttacks(x[i3], y[ii]);
						    		break;
						    	default:
						    		x[i3].style.animation ="pulse5 0.5s";
						    		bulletShoot(x[i3], y[ii]);//remove health if within range

						    }
						    x[i3].addEventListener("animationend", listener, false);

						    

						    //y[ii].style.boxShadow="inset "+y[ii].dataset.health+"px 0px red";
						    y[ii].lastChild.style.boxShadow="red "+y[ii].dataset.health+"px 0px inset";
						    if (y[ii].dataset.health<=0) {
						    	//console.log(y[ii].lastChild.style.width);
						    	revenue=revenue+Math.round((parseInt(y[ii].lastChild.style.width)/3.2)+10);
						    	y[ii].remove(); 
						    	updateRevenue();
						    }
						}else{
							//todo:check if it already has the class
							//todo: currently removing animation after 1 leaves area
								//todo: need to check if any left in area before removing
									//count all else, if == array.length - remove
						}
					}
				}
			}

			function listener(){
				event.target.preventDefault;
				event.target.style.animation = '';
				void event.target.offsetWidth;
			}

			//for each bullet - check distance from enemy 
			//if <0 distance - remove bullet - damage enemy - dataset bullet attack 

			/*todo:
				- move bullets in container in direction listed in dataset
				- if a bullet is within range of an enemy - remove both
				- if bullet is outside of tower range (list as dataset?) - remove bullet
				- if a bullet leaves the border - remove
			*/
			function towerAttacks(x,y){ console.log(x.dataset.id, y.dataset.type);
				var atkType = getBoxInfo(x.dataset.id);
			    //dmg wind, fire, earth, water
			    switch(parseInt(y.dataset.type)){
					case 1: //wind
						if (parseInt(x.dataset.spdr)==0) {
							x.dataset.spdr=15-(parseInt(x.dataset.spd));
							y.dataset.health=parseInt(y.dataset.health)
								-((atkType[1]*0)+(atkType[2]*0.5)
								+(atkType[3]*1)+(atkType[4]*0.5));
						}
						break;
					case 2: //fire
						if (parseInt(x.dataset.spdr)==0) {
							x.dataset.spdr=15-(parseInt(x.dataset.spd));
							y.dataset.health=parseInt(y.dataset.health)
								-((atkType[1]*0.5)+(atkType[2]*0)
								+(atkType[3]*0.5)+(atkType[4]*1));
						}
						break;
					case 3: //earth
						if (parseInt(x.dataset.spdr)==0) {
							x.dataset.spdr=15-(parseInt(x.dataset.spd));
							y.dataset.health=parseInt(y.dataset.health)
								-((atkType[1]*1)+(atkType[2]*0.5)
								+(atkType[3]*0)+(atkType[4]*0.5));
						}
						break;
					case 4: //water
						if (parseInt(x.dataset.spdr)==0) {
							x.dataset.spdr=15-(parseInt(x.dataset.spd));
							y.dataset.health=parseInt(y.dataset.health)
								-((atkType[1]*0.5)+(atkType[2]*1)
								+(atkType[3]*0.5)+(atkType[4]*0));
						}
						break;
				}
			}

			function bulletShoot(tower, target){
				//console.log(tower,target);
				
				if (parseInt(tower.dataset.spdr)==0) {
				tower.dataset.spdr=20-(parseInt(tower.dataset.spd));

					var bullet = document.createElement("div");    
						bullet.style.left=parseInt(tower.style.left)+20+"px";
						bullet.style.top=parseInt(tower.style.top)+20+"px";
						bullet.className="bullet"
						bullet.dataset.id=tower.dataset.id;
						//bullet.style.background="white";

						bullet.dataset.deg=Math.atan2(
							(parseInt(tower.style.top)-parseInt(target.style.top)), 
							(parseInt(tower.style.left)-parseInt(target.style.left))
							) * 180 / Math.PI + 270;

					document.getElementById("bulletContainer").appendChild(bullet);

					tower.style.transform="rotate("+Math.round(bullet.dataset.deg)+"deg)";
				}
			}

			var dx2, dy2, distance2
			function bulletMove(){
				var x = document.getElementById("enemyContainer").querySelectorAll(".enemyStyle");
				var y = document.getElementById("bulletContainer").querySelectorAll(".bullet");

				for (var i = y.length - 1; i >= 0; i--) { //each bullet: loop			
          			y[i].style.left = parseInt(y[i].style.left) + (Math.sin(y[i].dataset.deg*(Math.PI/180))) * 10 +"px";
					y[i].style.top = parseInt(y[i].style.top)- (Math.cos(y[i].dataset.deg*(Math.PI/180))) * 10 +"px";

					for (var i4 = x.length - 1; i4 >= 0; i4--) { //each enemy: loop
						//check if distance < sum of radius (enemy/bullet)
						dx2 = parseInt(x[i4].style.left)-parseInt(y[i].style.left);
						dy2 = parseInt(x[i4].style.top)-parseInt(y[i].style.top);
						distance2 = Math.sqrt(dx2 * dx2 + dy2 * dy2);
					

						if (distance2 <= parseInt(x[i4].style.width)) {
							x[i4].style.animation = 'pulse6 0.2s';
						    x[i4].addEventListener("animationend", listener, false);
							y[i].remove();
							//todo:fix health to be amount for tower type - not just all 10;
							x[i4].dataset.health=parseInt(x[i4].dataset.health)-10;
						}

						//todo: if out of border - remove y[i];
						//todo: fix bug: hits enemy even if close & just out of range
					}
				}
			}
			function clearBullets(){ //clear bullets at end of game
				var x = document.getElementById("bulletContainer").querySelectorAll(".bullet");
				for (var i = x.length - 1; i >= 0; i--) {
					x[i].remove();
				}
			}
			

			//list dmg type in enemy
			//list dmg of all 4 in tower
		</script>
	</body>
</html>
